# PostgreSQL Configuration for CS2 Analytics
# Optimized for analytics workloads with heavy read/write operations

# =============================================================================
# CONNECTION SETTINGS
# =============================================================================
listen_addresses = '*'
port = 5432
max_connections = 100          # PgBouncer handles client connections

# =============================================================================
# MEMORY SETTINGS
# =============================================================================
# Shared memory - adjust based on available RAM
shared_buffers = 256MB         # 25% of RAM for dedicated DB server
effective_cache_size = 768MB   # 75% of RAM
work_mem = 16MB                # Per-operation memory
maintenance_work_mem = 128MB   # For VACUUM, CREATE INDEX, etc.

# =============================================================================
# WRITE-AHEAD LOG (WAL)
# =============================================================================
wal_level = replica            # Enables replication for read replicas
max_wal_size = 1GB
min_wal_size = 80MB
wal_compression = on
wal_buffers = 16MB

# Checkpoint settings
checkpoint_completion_target = 0.9
checkpoint_timeout = 10min

# =============================================================================
# QUERY PLANNER
# =============================================================================
random_page_cost = 1.1         # SSD-optimized
effective_io_concurrency = 200 # SSD-optimized
default_statistics_target = 100

# =============================================================================
# PARALLEL QUERIES
# =============================================================================
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
max_parallel_maintenance_workers = 2
parallel_leader_participation = on

# =============================================================================
# LOGGING
# =============================================================================
logging_collector = on
log_directory = 'pg_log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_min_duration_statement = 1000   # Log queries > 1 second
log_checkpoints = on
log_connections = off
log_disconnections = off
log_lock_waits = on
log_temp_files = 0

# =============================================================================
# AUTOVACUUM
# =============================================================================
autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 1min
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_scale_factor = 0.1
autovacuum_analyze_scale_factor = 0.05

# =============================================================================
# REPLICATION (for read replicas)
# =============================================================================
max_wal_senders = 5
max_replication_slots = 5
hot_standby = on

# =============================================================================
# SECURITY
# =============================================================================
password_encryption = scram-sha-256
